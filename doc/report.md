# <center>华中科技大学计算机科学与技术学院</center>  <center>计算机组成原理实验报告</center>  <center>MIPS指令集单总线处理器设计</center>  
<center>计科校交 1801</center>  <center>车春池</center>  <center>U201816030</center>  <center>E-mail:1276675421@qq.com</center>  

## 定长指令周期 3 级时序
### 设计要求
本实验要求理解定长指令周期三级时序系统的设计，能利用该时序构造硬布线控制器，支持 5 条典型 MIPS 指令在单总线 CPU 上运行，最终 CPU 能运行内存冒泡排序。  

### 方案设计
#### MIPS 指令译码器设计
利用比较器将 32 位 MIPS 指令字译码生成相应的指令译码信号。  

#### 定长指令周期时序发生器设计
按照状态图填写相应的 excel 表格，自动生成次态逻辑表达式，然后在 logisim 中自动生成电路。  

#### 定长指令周期时序发生器输出函数设计
输出函数为组合逻辑，输入为状态寄存器的现态输出，输出为状态周期电位和节拍电位信号。  
按照时序输出要求，填写 excel 表格，自动生成各输出信号的逻辑表达式，在 logisim 中自动生成电路。  

#### 硬布线控制器组合逻辑单元设计
这里所有微操作信号都是反馈信号，指令译码信号，状态周期电位，节拍电位的组合逻辑表达式，如下式：  
$C_{n} = \sum_{m,i,k,j} (I_m * M_i * T_k * B_j)$  
列出所有微操作信号的产生条件，填写相应 excel 表格，自动生成逻辑表达式，然后在 logisim 中自动生成电路。  

#### 定长指令周期硬布线控制器设计
在实现指令译码，时序发生器关键功能部件，硬布线控制器等功能模块后，最终实现硬布线控制器的集成，硬布线控制器的集成。  
在硬布线子电路中将时序状态机与输出函数，状态寄存器正确连接，实现时序发生器逻辑。  

#### 定长指令周期单总线 CPU 设计
在 RAM 中加载 sort-5.hex 程序，ctrl+k 自动运行，程序应该运行至 0xbbb 节拍停下，指令计数为 251，注意最后一条指令是 beq 分支指令，会跳回当前指令继续执行，是死循环。  

### 实验步骤
#### MIPS 指令译码器设计
+ 分析指令字和译码信号的对应关系
+ 连接电路

#### 定长指令周期时序发生器设计
+ 分析状态图
+ 填表
+ 自动生成电路

#### 定长指令周期时序发生器输出函数设计
+ 分析时序输入与输出关系
+ 填表
+ 自动生成电路

#### 硬布线控制器组合逻辑单元设计
+ 分析微操作信号的产生条件
+ 填写表格
+ 自动生成电路

#### 定长指令周期硬布线控制器设计
+ 分析各模块功能和连接关系
+ 连接电路

#### 定长指令周期单总线 CPU 设计
+ 在 RAM 中加载程序，运行

### 故障与调试
### 测试与分析

## 现代时序
### 设计要求
本实验要求理解定长指令现代时序系统的设计，能利用该时序构造微程序控制器，支持 5 条典型 MIPS 指令在单总线 CPU 上运行，最终 CPU 能运行内存冒泡排序。  
### 方案设计
#### MIPS 指令译码器设计
利用比较器将 32 位 MIPS 指令字译码生成相应的指令译码信号。  

#### 单总线 CPU 微程序入口查找逻辑
根据指令译码信号生成 5 位的微程序入口地址，组合逻辑。  
填写 excel 表格，表格自动生成逻辑表达式。  

#### 单总线 CPU 微程序条件判别测试逻辑
填写 excel 表格中的组合逻辑真值表，表格自动生成逻辑表达式，在 logisim 中利用分析组合逻辑电路功能自动生成电路。  

#### 单总线 CPU 微程序控制器设计
将微程序入口查找逻辑，判别测试逻辑，控制存储器等部件进行适当连接，实现微程序控制器的主要数据通路，设计微程序并加载到控制存储器中。  
微程序设计可以通过填写 excel 文件中的微程序自动生成表自动生成。  

#### 采用微程序的单总线 CPU 设计
在 RAM 中加载 sort-5.hex 程序，ctrl+k 自动运行，程序应该运行至 0x7c1 节拍停下。  

#### 现代时序硬布线控制器状态机设计
按状态图填写 excel 表格，自动生成次态逻辑表达式后，即可在 logisim 中自动生成该电路。  

#### 现代时序硬布线控制器设计
在实现指令译码，现代时序状态机模块后，最终实现硬布线控制器的集成，在实验框架中把相应模块正确连接起来就行了，注意硬布线控制器组合逻辑不需要实现直接采用微程序控制器的控制存储器代替即可。  

### 实验步骤
#### MIPS 指令译码器设计
+ 分析指令字和译码信号的对应关系
+ 连接电路

#### 单总线 CPU 微程序入口查找逻辑
+ 分析微程序入口查找逻辑
+ 填表
+ 自动生成电路

#### 单总线 CPU 微程序条件判别测试逻辑
+ 分析微程序条件判别测试逻辑
+ 填表
+ 自动生成电路

#### 单总线 CPU 微程序控制器设计
+ 分析微程序控制器各模块部件之间关系
+ 连接电路
+ 填表生成微程序
+ 将微程序填入存储器中
+ 运行

#### 采用微程序的单总线 CPU 设计
+ 在 RAM 中加载程序，运行

#### 现代时序硬布线控制器状态机设计
+ 分析现代时序硬布线核心部件状态机
+ 填表
+ 自动生成电路

#### 现代时序硬布线控制器设计
+ 分析现代时序硬布线控制器各模块部件之间关系
+ 连接电路
+ 填表生成微程序
+ 将微程序填入存储器中
+ 运行

### 故障与调试
### 测试与分析

## 现代时序中断机制实现
### 设计要求
本实验需要在理解现代时序控制器中断机制的实现原理的前提下，为采用现代时序单总线结构的 MIPS CPU 增加中断处理机制，可实现多个外部按键中断事件的随机处理，本实验需要完成现代时序微程序控制器的基础上完成，需要增加硬件数据通路，增加中断返回指令 eret 的支持，需要中断服务程序配合。  

### 方案设计
#### MIPS 指令译码器设计
利用比较器将 32 位 MIPS 指令字译码生成相应的指令译码信号。  

#### 支持中断的微程序入口查找逻辑
填写 excel 表格中的微程序入口地址表格，自动生成逻辑表达式，在 logisim 中利用分析组合逻辑电路功能自动生成电路。  

#### 支持中断的微程序条件判别逻辑
填写 excel 表格中的组合逻辑真值表，自动生成逻辑表达式，在 logisim 中利用分析组合逻辑电路功能自动生成电路。  

#### 支持中断的微程序控制器设计
将微程序入口查找逻辑，判别测试逻辑，控制存储器等部件进行适当连接，实现微程序控制器的主要数据通路，设计微程序并加载到控制存储器中。  
微程序设计可以通过填写 excel 文件中的微程序自动生成表自动生成。  

#### 支持中断的微程序单总线 CPU 设计
完成前面所有关卡之后，在单总线数据通路中增加于中断相关的硬件模块，主要包括异常程序地址计数器 epc，中断使能寄存器 ie，中断控制等模块，需要在主电路中将这些模块进行有效连接，并在本关进行最终的联调，测试 CPU 是否能正常响应 2 个按键对应的中断服务程序。  

#### 支持中断的现代时序硬布线控制器状态机设计
按照状态图，填写 excel 表，自动生成次态逻辑表达式后，即可在 logisim 中自动生成该电路。  

#### 支持中断的现代时序硬布线控制器设计
在实现指令译码、现代时序状态机模块后，最终实现硬布线控制器的集成，硬布线控制器组合逻辑不需要实现直接采用微程序控制器的控制存储器代替即可，完成测试后用硬布线控制器替换cpu中的微程序控制器进行程序测试。  

### 实验步骤
#### MIPS 指令译码器设计
+ 分析指令字和译码信号的对应关系
+ 连接电路

#### 支持中断的微程序入口查找逻辑
+ 分析支持中断的微程序入口查找逻辑
+ 填表
+ 自动生成电路

#### 支持中断的微程序条件判别逻辑
+ 分析支持中断的微程序条件判别测试逻辑
+ 填表
+ 自动生成电路

#### 支持中断的微程序控制器设计
+ 分析支持中断的微程序控制器各模块部件之间关系
+ 连接电路
+ 填表生成微程序
+ 将微程序填入存储器中
+ 运行

#### 支持中断的微程序单总线 CPU 设计
+ 分析在单总线数据通路中增加与中断相关的硬件模块
+ 对增加的硬件模块进行联调
+ 运行

#### 支持中断的现代时序硬布线控制器状态机设计
+ 分析支持中断的现代时序硬布线控制器各模块部件之间关系
+ 连接电路
+ 填表生成微程序
+ 将微程序填入存储器中
+ 运行

### 故障与调试
### 测试与分析